@page
@model EJCFitnessGym.Pages.Admin.DashboardModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

<section class="ejc-admin-page" data-admin-dashboard>
    <div class="ejc-admin-layout" data-admin-layout>
        <partial name="/Pages/Shared/_AdminSidebar.cshtml" />

        <div class="ejc-admin-content">
            <div class="ejc-page-header">
                <div>
                    <span class="ejc-eyebrow">Operations</span>
                    <h1 class="h2 mb-1">Admin Dashboard</h1>
                    <p class="ejc-muted mb-0">Monitor operations, billing, and floor activity in one compact control panel.</p>
                </div>
                <div class="ejc-actions">
                    @if (User.IsInRole("SuperAdmin"))
                    {
                        <a class="btn btn-primary" asp-controller="MemberAccounts" asp-action="Create">Add Member</a>
                    }
                    <a class="btn btn-outline-primary" asp-page="/Admin/Reports">View Reports</a>
                    <button type="button"
                            class="btn btn-outline-primary ejc-filter-trigger"
                            data-bs-toggle="offcanvas"
                            data-bs-target="#dashboardFilterPanel"
                            aria-controls="dashboardFilterPanel"
                            title="Open date filter">
                        <i class="bi bi-funnel-fill"></i>
                    </button>
                </div>
            </div>

            <div class="ejc-admin-metrics">
                <article class="ejc-admin-metric">
                    <a class="ejc-admin-metric-link" asp-controller="MemberAccounts" asp-action="Index">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="ejc-admin-metric-label">Active Members</span>
                            <span class="ejc-admin-metric-icon"><i class="bi bi-people-fill"></i></span>
                        </div>
                        <strong data-kpi-value="activeMembers">0</strong>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge text-bg-success" data-kpi-badge="activeMembers">Average</span>
                            <span class="ejc-admin-metric-meta" data-kpi-meta="activeMembers">for selected period</span>
                        </div>
                    </a>
                </article>
                <article class="ejc-admin-metric">
                    <a class="ejc-admin-metric-link" asp-page="/Admin/Reports">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="ejc-admin-metric-label">Check-Ins</span>
                            <span class="ejc-admin-metric-icon"><i class="bi bi-person-check-fill"></i></span>
                        </div>
                        <strong data-kpi-value="checkIns">0</strong>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge text-bg-primary" data-kpi-badge="checkIns">Total</span>
                            <span class="ejc-admin-metric-meta" data-kpi-meta="checkIns">for selected period</span>
                        </div>
                    </a>
                </article>
                <article class="ejc-admin-metric">
                    <a class="ejc-admin-metric-link" asp-controller="MemberAccounts" asp-action="Index">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="ejc-admin-metric-label">Pending Follow-Ups</span>
                            <span class="ejc-admin-metric-icon"><i class="bi bi-person-lines-fill"></i></span>
                        </div>
                        <strong data-kpi-value="followUps">0</strong>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge text-bg-warning" data-kpi-badge="followUps">Daily Avg</span>
                            <span class="ejc-admin-metric-meta" data-kpi-meta="followUps">from selected dates</span>
                        </div>
                    </a>
                </article>
                <article class="ejc-admin-metric">
                    <a class="ejc-admin-metric-link" asp-page="/Admin/Payments">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="ejc-admin-metric-label">Audit Alerts</span>
                            <span class="ejc-admin-metric-icon"><i class="bi bi-shield-exclamation"></i></span>
                        </div>
                        <strong data-kpi-value="auditAlerts">0</strong>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge text-bg-danger" data-kpi-badge="auditAlerts">Peak</span>
                            <span class="ejc-admin-metric-meta" data-kpi-meta="auditAlerts">daily count in range</span>
                        </div>
                    </a>
                </article>
            </div>

            <div class="row g-4 mb-4">
                <div class="col-xl-8">
                    <div class="card h-100">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <h5 class="mb-0">Revenue Trend</h5>
                            <span class="text-muted small" data-trend-subtitle>Last 30 days</span>
                        </div>
                        <div class="card-body">
                            <div class="ejc-revenue-chart-wrap">
                                <canvas id="revenueTrendChart" aria-label="Revenue trend chart"></canvas>
                            </div>
                            <p class="ejc-muted mb-0 mt-3" data-revenue-summary>Revenue summary for the selected period.</p>
                        </div>
                    </div>
                </div>

                <div class="col-xl-4">
                    <div class="card h-100">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <h5 class="mb-0">Check-In Activity</h5>
                            <span class="text-muted small" data-checkins-subtitle>Recent days</span>
                        </div>
                        <div class="card-body">
                            <ul class="ejc-checkin-list" data-checkins-list></ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-xl-6">
                    <div class="card h-100">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <h5 class="mb-0">Quick Actions</h5>
                            <span class="text-muted small">Admin tools</span>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-2">
                                <a class="btn btn-outline-primary text-start" asp-controller="MemberAccounts" asp-action="Index">Manage Members</a>
                                <a class="btn btn-outline-primary text-start" asp-page="/Admin/Payments">Review Payments</a>
                                <a class="btn btn-outline-primary text-start" asp-page="/Admin/Inventory">Update Inventory</a>
                                <a class="btn btn-outline-primary text-start" asp-page="/Admin/Reports">Open Reports</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-6">
                    <div class="card h-100">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <h5 class="mb-0">System Alerts</h5>
                            <span class="text-muted small">Needs attention</span>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center">
                                    Low stock items
                                    <span class="badge bg-warning text-dark">12</span>
                                </li>
                                <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center">
                                    Pending collections
                                    <span class="badge bg-danger">7</span>
                                </li>
                                <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center">
                                    Failed check-ins
                                    <span class="badge bg-secondary">3</span>
                                </li>
                                <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center">
                                    Role change approvals
                                    <span class="badge bg-info text-dark">2</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="offcanvas offcanvas-end ejc-filter-offcanvas" tabindex="-1" id="dashboardFilterPanel" aria-labelledby="dashboardFilterPanelLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="dashboardFilterPanelLabel">Date Filter</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <p class="ejc-muted small mb-3">
                Filter by date range and trend mode. KPI cards, check-ins, and revenue trend all update together.
            </p>

            <div class="mb-3">
                <label class="form-label small text-uppercase text-muted mb-2">Quick Range</label>
                <div class="d-grid gap-2">
                    <div class="btn-group btn-group-sm" role="group" aria-label="Quick date range row 1">
                        <button type="button" class="btn btn-outline-primary" data-filter-quick="today">Today</button>
                        <button type="button" class="btn btn-outline-primary" data-filter-quick="7">Last 7D</button>
                        <button type="button" class="btn btn-outline-primary" data-filter-quick="30">Last 30D</button>
                    </div>
                    <div class="btn-group btn-group-sm" role="group" aria-label="Quick date range row 2">
                        <button type="button" class="btn btn-outline-primary" data-filter-quick="ytd">YTD</button>
                        <button type="button" class="btn btn-outline-primary" data-filter-quick="365">Last 1Y</button>
                        <button type="button" class="btn btn-outline-primary" data-filter-quick="730">Last 2Y</button>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label for="filterStartDate" class="form-label">From</label>
                <input id="filterStartDate" type="date" class="form-control" data-filter-start />
            </div>

            <div class="mb-3">
                <label for="filterEndDate" class="form-label">To</label>
                <input id="filterEndDate" type="date" class="form-control" data-filter-end />
            </div>

            <div class="mb-4">
                <label for="filterTrendMode" class="form-label">Trend Mode</label>
                <select id="filterTrendMode" class="form-select" data-trend-mode>
                    <option value="daily">Day to day</option>
                    <option value="yearly">Year to year</option>
                </select>
            </div>

            <div class="d-grid gap-2">
                <button type="button" class="btn btn-primary" data-filter-apply>Apply Filter</button>
                <button type="button" class="btn btn-outline-light" data-filter-reset>Reset to Last 30 Days</button>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="~/js/admin-dashboard.js" asp-append-version="true"></script>
}
